<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Sura Cinematic Universe</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 20px;
      text-align: center;
    }
    h1 {
      margin-bottom: 20px;
    }
    #videoList {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
    }
    .video-card {
      width: 250px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      overflow: hidden;
    }
    .thumbnail {
      width: 100%;
      height: 150px;
      object-fit: cover;
    }
    .video-content {
      padding: 10px;
    }
    .video-title {
      font-weight: bold;
      margin-bottom: 10px;
    }
    .watch-btn {
      display: inline-block;
      padding: 6px 12px;
      background: #222;
      color: white;
      border-radius: 4px;
      text-decoration: none;
    }
    #emptyMessage {
      display: none;
      font-size: 18px;
      margin-top: 40px;
    }
  </style>
</head>
<body>
  <h1>Sura Cinematic Universe</h1>
  <div id="videoList"></div>
  <div id="emptyMessage">No videos found.</div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getFirestore, collection, onSnapshot } 
      from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA-Is9ekckvL3otvCDbz90plvEvlPBRDT4",
      authDomain: "sura-fans-auth.firebaseapp.com",
      projectId: "sura-fans-auth",
      storageBucket: "sura-fans-auth.firebasestorage.app",
      messagingSenderId: "399675179284",
      appId: "1:399675179284:web:b4e7b2d0a409c2eab34201"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ✅ Thumbnail-safe rendering
    onSnapshot(collection(db, "videos"), (snapshot) => {
      const videoList = document.getElementById("videoList");
      const emptyMessage = document.getElementById("emptyMessage");
      videoList.innerHTML = "";

      if (snapshot.empty) {
        emptyMessage.style.display = "block";
        return;
      }
      emptyMessage.style.display = "none";

      snapshot.forEach((docSnap) => {
        const data = docSnap.data();
        console.log("VIDEO DOC:", docSnap.id, data);

        const possibleThumbFields = [
          data.thumbnail,
          data.thumb,
          data.thumbnailUrl,
          data.thumbnail_url,
          data.image
        ];
        let thumbnail = (possibleThumbFields.find(t => t && typeof t === "string") || "").trim();

        if (!thumbnail && data.url) {
          const u = data.url.trim();
          let vid = "";
          if (u.includes("watch?v=")) vid = u.split("watch?v=")[1].split("&")[0];
          else if (u.includes("youtu.be/")) vid = u.split("youtu.be/")[1].split("?")[0];
          else if (u.includes("shorts/")) vid = u.split("shorts/")[1].split("?")[0];
          if (vid) thumbnail = `https://img.youtube.com/vi/${vid}/hqdefault.jpg`;
        }

        if (!thumbnail) thumbnail = "Images/default.jpg";

        const card = document.createElement("div");
        card.className = "video-card";

        const img = document.createElement("img");
        img.className = "thumbnail";
        img.src = thumbnail;
        img.alt = data.title || "Thumbnail";
        img.onerror = () => {
          console.warn("Thumbnail load failed:", thumbnail, "for doc:", docSnap.id);
          img.src = "Images/default.jpg";
        };

        const content = document.createElement("div");
        content.className = "video-content";

        const titleEl = document.createElement("div");
        titleEl.className = "video-title";
        titleEl.textContent = data.title || "Untitled";

        const a = document.createElement("a");
        a.className = "watch-btn";
        a.href = data.url || "#";
        a.target = "_blank";
        a.textContent = "▶ Watch";

        content.appendChild(titleEl);
        content.appendChild(a);

        card.appendChild(img);
        card.appendChild(content);

        videoList.appendChild(card);
      });
    });
  </script>
</body>
</html>